<main class="page-employee">
  <section class="veg-hero mb-4">
    <div class="container">
      <div class="veg-hero__wrapper">
        <div class="veg-hero__media">
          <div class="veg-hero__img">
            <img src="../images/delices_Viandard.jpg" alt="Espace Employé">
          </div>

          <div class="veg-hero__overlay d-flex align-items-center justify-content-center">
            <h1 class="veg-hero__title">Espace Employé</h1>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="container my-4">
    <div class="card border-0 shadow-lg">
      <div class="card-body p-3 p-md-4">

        <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2">
          <div>
            <h2 class="h5 mb-1">Dashboard</h2>
            <p class="text-muted mb-0" id="employee-welcome">Chargement…</p>
          </div>

          <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary btn-sm" id="btn-refresh">
              Rafraîchir
            </button>
            <a class="btn btn-outline-secondary btn-sm" href="/account" onclick="route(event)">
              Mon compte
            </a>
          </div>
        </div>

        <hr class="my-3" />

        <!-- Onglets -->
        <div class="d-flex flex-column flex-sm-row gap-2" role="tablist" aria-label="Onglets employé">
          <button class="btn btn-secondary employee-tab" data-tab="menus" type="button">
            Menus
          </button>
          <button class="btn btn-secondary employee-tab" data-tab="commandes" type="button">
            Commandes
          </button>
          <button class="btn btn-secondary employee-tab" data-tab="avis" type="button">
            Avis
          </button>
        </div>

        <!-- Contenu -->
        <div class="mt-3">

          <!-- MENUS -->
          <section id="panel-menus" class="employee-panel d-none">
            <div class="row g-3">
              <div class="col-12 col-lg-5">
                <div class="card border-0 shadow-sm">
                  <div class="card-body p-3">
                    <h3 class="h6 mb-3">Créer un menu</h3>

                    <form id="menu-create-form" novalidate>
                      <div class="mb-2">
                        <label class="form-label small mb-1" for="m_titre">Titre</label>
                        <input class="form-control form-control-sm" id="m_titre" required />
                        <div class="invalid-feedback">Titre requis.</div>
                      </div>

                      <div class="mb-2">
                        <label class="form-label small mb-1" for="m_desc">Description</label>
                        <textarea class="form-control form-control-sm" id="m_desc" rows="2"></textarea>
                      </div>

                      <div class="row g-2">
                        <div class="col-6">
                          <label class="form-label small mb-1" for="m_nbmin">Nb pers mini</label>
                          <input class="form-control form-control-sm" id="m_nbmin" type="number" min="1" required />
                          <div class="invalid-feedback">Minimum requis.</div>
                        </div>
                        <div class="col-6">
                          <label class="form-label small mb-1" for="m_prix">Prix / pers</label>
                          <input class="form-control form-control-sm" id="m_prix" type="number" step="0.01" min="0" required />
                          <div class="invalid-feedback">Prix requis.</div>
                        </div>
                      </div>

                      <div class="row g-2 mt-1">
                        <div class="col-6">
                          <label class="form-label small mb-1" for="m_stock">Stock</label>
                          <input class="form-control form-control-sm" id="m_stock" type="number" min="0" required />
                          <div class="invalid-feedback">Stock requis.</div>
                        </div>
                        <div class="col-6 d-flex align-items-end">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="m_pret" />
                            <label class="form-check-label" for="m_pret">Prêt matériel</label>
                          </div>
                        </div>
                      </div>
                      <!-- THEME + REGIME -->
                      <div class="row g-2 mt-2">
                        <!-- THEME -->
                        <div class="col-12 col-md-6">
                          <label class="form-label small mb-1" for="m_theme">Thème</label>
                          <div class="d-flex gap-2">
                            <select id="m_theme" class="form-select form-select-sm" required>
                              <option value="">Chargement…</option>
                            </select>
                            <button type="button" class="btn btn-outline-secondary btn-sm" id="btnThemeToggle">+ Nouveau</button>
                          </div>

                          <div id="themeCreateBox" class="mt-2 d-none">
                            <div class="input-group input-group-sm">
                              <input id="themeLibelleInput" class="form-control" placeholder="Ex: Noël" />
                              <button type="button" class="btn btn-secondary" id="btnThemeCreate">Créer</button>
                            </div>
                            <div class="form-text text-danger" id="themeMsg"></div>
                          </div>

                          <div class="invalid-feedback">Thème requis.</div>
                        </div>

                        <!-- REGIME -->
                        <div class="col-12 col-md-6">
                          <label class="form-label small mb-1" for="m_regime">Régime</label>
                          <div class="d-flex gap-2">
                            <select id="m_regime" class="form-select form-select-sm" required>
                              <option value="">Chargement…</option>
                            </select>
                            <button type="button" class="btn btn-outline-secondary btn-sm" id="btnRegimeToggle">+ Nouveau</button>
                          </div>

                          <div id="regimeCreateBox" class="mt-2 d-none">
                            <div class="input-group input-group-sm">
                              <input id="regimeLibelleInput" class="form-control" placeholder="Ex: Végétarien" />
                              <button type="button" class="btn btn-secondary" id="btnRegimeCreate">Créer</button>
                            </div>
                            <div class="form-text text-danger" id="regimeMsg"></div>
                          </div>

                          <div class="invalid-feedback">Régime requis.</div>
                        </div>
                      </div>
                      <button class="btn btn-secondary w-100 mt-3" type="submit" id="m_submit">
                        Créer le menu
                      </button>

                      <p class="text-muted small mb-0 mt-2">
                        Après création, tu pourras ajouter des plats, photos et allergènes.
                      </p>
                    </form>
                  </div>
                </div>
              </div>

              <div class="col-12 col-lg-7">
                <div class="card border-0 shadow-sm">
                  <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-center gap-2">
                      <h3 class="h6 mb-0">Menus existants</h3>
                      <input class="form-control form-control-sm" id="menus-search" placeholder="Rechercher…" style="max-width: 240px;">
                    </div>

                    <div class="mt-3" id="menus-list">
                      <p class="text-muted mb-0">Chargement…</p>
                    </div>

                    <!-- Template item menu (boutons définis dans le HTML) -->
                    <template id="tpl-menu-item">
                      <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center gap-2">
                          <div class="me-2">
                            <div class="fw-semibold" data-field="titre">Titre</div>
                            <div class="small text-muted" data-field="meta">Stock: 0</div>
                          </div>

                          <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end">
                            <span class="badge text-bg-secondary" data-field="id">0</span>

                            <button
                              type="button"
                              class="btn btn-outline-secondary btn-sm"
                              data-action="select">
                              Sélectionner
                            </button>

                            <a
                              class="btn btn-secondary btn-sm"
                              href="/menu-edit?id=1"
                              onclick="route(event)"
                              data-action="edit">
                              Modifier
                            </a>

                            <button
                              type="button"
                              class="btn btn-outline-danger btn-sm"
                              data-action="delete">
                              Supprimer
                            </button>
                          </div>
                        </div>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- COMMANDES -->
          <section id="panel-commandes" class="employee-panel d-none">
            <div class="card border-0 shadow-sm">
              <div class="card-body p-3">
                <div class="d-flex flex-column flex-md-row align-items-stretch align-items-md-end justify-content-between gap-2">
                  <div>
                    <h3 class="h6 mb-1">Gestion des commandes</h3>
                    <p class="text-muted small mb-0">Filtrer par statut ou client, puis mise à jour des étapes.</p>
                  </div>

                  <div class="d-flex flex-column flex-sm-row gap-2">
                    <select class="form-select form-select-sm" id="cmd-filter-statut" style="min-width: 210px;">
                      <option value="">Tous statuts</option>
                      <option value="en_attente">En attente</option>
                      <option value="acceptee">Acceptée</option>
                      <option value="en_preparation">En préparation</option>
                      <option value="en_cours_de_livraison">En cours de livraison</option>
                      <option value="livree">Livrée</option>
                      <option value="en_attente_du_retour_de_materiel">Attente retour matériel</option>
                      <option value="terminee">Terminée</option>
                    </select>

                    <input class="form-control form-control-sm" id="cmd-filter-q" placeholder="Client: nom, email, tel…" style="min-width: 240px;">

                    <button class="btn btn-secondary btn-sm" id="cmd-filter-btn">Filtrer</button>
                  </div>
                </div>

                <hr class="my-3" />

                <div id="cmd-list">
                  <p class="text-muted mb-0">Chargement…</p>
                </div>
              </div>
            </div>

            <!-- Modal annulation (motif + mode contact) -->
            <div class="modal fade" id="modal-cancel" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Annuler une commande</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                  </div>
                  <div class="modal-body">
                    <p class="text-muted small">
                      Conformément à la clause de l'entreprise, tu dois indiquer le mode de contact et le motif.
                    </p>

                    <input type="hidden" id="cancel-commande-id" />

                    <div class="mb-2">
                      <label class="form-label small mb-1" for="cancel-contact">Mode de contact</label>
                      <select class="form-select form-select-sm" id="cancel-contact" required>
                        <option value="">Choisir…</option>
                        <option value="gsm">Appel GSM</option>
                        <option value="email">Email</option>
                      </select>
                      <div class="invalid-feedback">Mode requis.</div>
                    </div>

                    <div class="mb-2">
                      <label class="form-label small mb-1" for="cancel-motif">Motif</label>
                      <textarea class="form-control form-control-sm" id="cancel-motif" rows="3" required></textarea>
                      <div class="invalid-feedback">Motif requis.</div>
                    </div>

                    <div class="alert alert-warning small mb-0">
                      Astuce: “Contacté par email le 12/02, client indisponible, demande report, annulation…”
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Fermer</button>
                    <button class="btn btn-secondary btn-sm" id="cancel-submit">Confirmer l’annulation</button>
                  </div>
                </div>
              </div>
            </div>

          </section>

          <!-- AVIS -->
          <section id="panel-avis" class="employee-panel d-none">
            <div class="card border-0 shadow-sm">
              <div class="card-body p-3">
                <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2">
                  <div>
                    <h3 class="h6 mb-1">Validation des avis</h3>
                    <p class="text-muted small mb-0">Uniquement avis liés à une commande terminée.</p>
                  </div>

                  <button class="btn btn-secondary btn-sm" id="avis-refresh">Rafraîchir</button>
                </div>

                <hr class="my-3" />

                <div id="avis-list">
                  <p class="text-muted mb-0">Chargement…</p>
                </div>
              </div>
            </div>
          </section>

        </div>

        <p id="employee-error" class="text-danger text-center mt-3 d-none"></p>

      </div>
    </div>
  </section>
</main>

<script type="module" src="../script/employee/employee.js"></script>
